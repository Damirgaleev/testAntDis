# TableCRM WebApp - Форма оформления заказа

Мобильное веб-приложение для оформления заказов в TableCRM.

## Технологии

- **React 18** + **TypeScript**
- **Vite** — сборщик
- **Ant Design 5** — UI библиотека
- **Axios** — HTTP клиент
- **TableCRM API** — интеграция с бэкендом

## Установка и запуск

```bash
# Установка зависимостей
npm install

# Запуск в режиме разработки
npm run dev

# Сборка для продакшена
npm run build

# Предпросмотр продакшен сборки
npm run preview
```

## Структура проекта

```
src/
  ├── api/
  │   └── axios.ts              # Настроенный API клиент
  ├── components/
  │   ├── OrderForm.tsx         # Основная форма заказа
  │   ├── ClientSelectModal.tsx # Модальное окно выбора клиентов
  │   ├── SelectModal.tsx       # Универсальное модальное окно
  │   └── ProductSelectModal.tsx # Модальное окно выбора товаров
  ├── contexts/
  │   └── ThemeContext.tsx      # Контекст темы (светлая/темная)
  ├── App.tsx                   # Главный компонент
  └── main.tsx                  # Точка входа
```

## Функциональность

### Форма оформления заказа

1. **Авторизация по токену** — токен кассы передается в query-параметрах всех запросов
2. **Поиск клиентов** — загрузка всех клиентов с пагинацией (по 100 записей)
3. **Выбор параметров заказа:**
   - Счет
   - Организация
   - Склад
   - Тип цены
4. **Добавление товаров** — с возможностью изменения количества
5. **Создание продажи** — две кнопки: "Создать продажу" и "Создать и провести"

### Темы оформления

Приложение поддерживает светлую и темную темы:
- Переключатель в правом верхнем углу
- Автоматическое определение системной темы
- Сохранение выбора в localStorage
- Плавные переходы между темами

## Работа с API

### Настройка токена

Токен вводится в первое поле формы и автоматически добавляется ко всем запросам:

```typescript
// Токен добавляется в query-параметры
// Пример: /contragents/?token=your_token_here
```

### Получение клиентов

```typescript
// Загрузка клиентов с пагинацией
const response = await apiClient.get('/contragents/', {
  params: {
    limit: 100,
    offset: 0,
  }
});

// Ответ: { count: 4041, result: [...] }
```

### Создание продажи

```typescript
const orderData = {
  clientPhone: '+79991234567',
  accountId: '1',
  organizationId: '1',
  warehouseId: '1',
  priceTypeId: '1',
  items: [
    { productId: '1', quantity: 2, price: 150 }
  ]
};

const response = await apiClient.post('/sales', orderData);
```

## Компоненты

### OrderForm

Основной компонент формы заказа с полной логикой работы.

### ClientSelectModal

Модальное окно для выбора клиента:
- Поиск по телефону, имени, ИНН
- Пагинация (загрузка по 100 записей)
- Кнопка "Загрузить еще"
- Отображение общего количества клиентов

### SelectModal

Универсальное модальное окно для выбора из списка:
- Используется для счетов, организаций, складов, типов цен
- Поиск по полям
- Настраиваемые поля отображения

### ProductSelectModal

Модальное окно выбора товаров с моковыми данными (готово к интеграции с API).

## Стилизация

Все цвета вынесены в CSS-переменные для поддержки тем:

```css
:root {
  --bg-primary: #1a1a2e;
  --text-primary: #ffffff;
  --primary-color: #722ed1;
  /* ... */
}

[data-theme='light'] {
  --bg-primary: #f5f5f5;
  --text-primary: #262626;
  /* ... */
}
```

## API Endpoints

- `GET /contragents/` — получение списка клиентов
- `GET /accounts/` — получение счетов
- `GET /organizations/` — получение организаций
- `GET /warehouses/` — получение складов
- `GET /price-types/` — получение типов цен
- `GET /products/` — получение товаров
- `POST /sales` — создание продажи

Все запросы автоматически включают токен в query-параметрах.

## Дальнейшая разработка

- [ ] Интеграция реальных API для счетов, организаций, складов
- [ ] Интеграция API товаров
- [ ] Валидация формы перед отправкой
- [ ] Обработка ошибок с уведомлениями
- [ ] Сохранение черновиков заказов
- [ ] История заказов

